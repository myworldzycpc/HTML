[comment]: <> (站内消息的改进想法（爆炸的解决方案 & 其他优化建议）)

<font size="7"><b>爆炸的解决方案</b></font>

# 1. 使用分页（推荐）

大多数网络聊天室不会直接把所有消息全部拉取过来，这样对服务器的负担很大（数据传输量很大），而且，消息太多也看不过来。

结合我自己用 Django 做网页聊天室的经验，我建议这样：先加载最近的一部分消息（比如100条），往上滑才会加载更早的消息。

JavaScript 监听 `scroll` 事件，检查滚动条位置是否为 $0$。

然后我简单写了个函数，用来获取滚动条位置：

```javascript
//获取当前滚动条的位置
function getScrollTop(){
    var scrollTop = 0
    if (document.documentElement && document.documentElement.scrollTop) {
        scrollTop = document.documentElement.scrollTop
    } else if (document.body) {
        scrollTop = document.body.scrollTop
    }
    return scrollTop
}
```

如果 `getScrollTop()` 返回 $0$，则说明滑到顶部了。

可以在对服务器的请求参数中加入消息列表切片范围（例如 `from=100&to=200`，服务器响应时只返回切片内的消息。

同时也要记得，服务器响应初始 Get 请求时只返回用户列表和最后的消息，而并非所有用户的消息，只有点开某个用户，才把消息传过来。

# 2. 定期定量删除 + 手动删除 （这是垫底的方案了）

建议加入一个手动清空聊天记录功能，或者是定期删除（删除的时候，可以将消息归档，即存在某个地方供以后查阅，而并非永久删除）

同时，消息到达爆炸量后，需要直接归档，要不然接下来的消息会收不到。

---

<font size="7"><b>其他优化建议</b></font>

# 1. 超文本消息

简单说来，就是站内消息中使用Markdown，像评论区里那样，这样就可以在站内消息中发图片&公式&视频了。

# 2. 撤回消息功能

发出去的消息可能有错别字（或者是发错人），所以建议加个撤回功能，撤回的消息可以依旧存在于服务器上，供以后查阅。但是，对方是看不到撤回的消息的。

如果撤回之后还能重新编辑就更好了。（简单的实现就是把消息撤到输入框里）
